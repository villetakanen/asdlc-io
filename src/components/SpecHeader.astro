---
import type { ArticleData } from "../content/config";
import StatusBadge from "./StatusBadge.astro";

interface Props {
  data: ArticleData;
}

const { data } = Astro.props;

// Extract fields we display explicitly
const { title, description, status } = data;

// Get remaining metadata fields to loop over
const metadataFields: Array<{ key: string; value: unknown }> = [];

// Add lastUpdated (always present)
metadataFields.push({ key: "lastUpdated", value: data.lastUpdated });

// Add tags if present
if (data.tags && data.tags.length > 0) {
  metadataFields.push({ key: "tags", value: data.tags });
}

// Add relatedIds if present
if (data.relatedIds && data.relatedIds.length > 0) {
  metadataFields.push({ key: "relatedIds", value: data.relatedIds });
}

// Helper function to format relatedId links
// "patterns/the-spec" -> { href: "/patterns/the-spec", text: "the-spec" }
function formatRelatedId(id: string) {
  const parts = id.split("/");
  const slug = parts[parts.length - 1];
  return {
    href: `/${id}`,
    text: slug,
  };
}
---

<header class="spec-header border-box content">
  <h1>{title}</h1>
  <dl class="spec-meta mono">
    <div class="spec-row">
      <dt>Description</dt>
      <dd>{description || "â€”"}</dd>
    </div>
    <div class="spec-row">
      <dt>Status</dt>
      <dd><StatusBadge status={status} /></dd>
    </div>
    {status === "Deprecated" && data.supersededBy && data.supersededBy.length > 0 && (
      <div class="spec-row">
        <dt>Superseded By</dt>
        <dd>
          {data.supersededBy.map((link, index) => (
            <>
              <a href={`/${link}`}>{link}</a>
              {index < data.supersededBy!.length - 1 && ", "}
            </>
          ))}
        </dd>
      </div>
    )}
    {metadataFields.map((field) => (
      <div class="spec-row">
        <dt>{field.key === 'lastUpdated' ? 'Last Updated' : field.key === 'relatedIds' ? 'Related' : field.key.charAt(0).toUpperCase() + field.key.slice(1)}</dt>
        <dd>
          {field.key === 'lastUpdated' && field.value instanceof Date && (
            <time datetime={field.value.toISOString()}>
              {field.value.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}
            </time>
          )}
          {field.key === 'tags' && Array.isArray(field.value) && field.value.join(', ')}
          {field.key === 'relatedIds' && Array.isArray(field.value) && (
            <>
              {(field.value as string[]).map((id, index) => {
                const formatted = formatRelatedId(id);
                return (
                  <>
                    <a href={formatted.href}>{formatted.text}</a>
                    {index < (field.value as string[]).length - 1 && ", "}
                  </>
                );
              })}
            </>
          )}
        </dd>
      </div>
    ))}
  </dl>
</header>
