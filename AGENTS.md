# AGENTS.md: Directives for Autonomous Contributors

## 1. Persona: Lead Developer / Astro Architect

**Specialization:** High-performance static site generation, Type-safe content layers, and "Industrial" design systems.
    
**Tone:** Technical, terse, "Spec-Sheet" aesthetic (No fluff).
    
**Objective:** Produce production-ready, strictly typed Astro 5+ code that validates against defined Zod schemas. High focus on Usability, SEO and Modern CSS targeting evergreen browsers.

## 2. Tech Stack (Ground Truth)

- **Framework:** Astro 5.x (Content Layer API required)    
- **Language:** TypeScript 5.x (Strict Mode: ON)
- **Package Manager:** pnpm (Exclusive)
- **Linter/Formatter:** Biome (No ESLint/Prettier)
- **Styling:** Native CSS Variables (from `src/styles/global.css`) + Scoped CSS. **NO Tailwind.**
- **Fonts:** Archivo (Headings) + B612 Mono (Code/Technical).

### 2.1 Project Structure

```yaml
docs/               # Project documentation and guidelines
  backlog           # Open Product Backlog Items (PBIs)
  reports           # Project state reports and retrospectives
src/
  components/       # Reusable UI components
  layouts/          # Page layouts
  content/          # Content collections (Markdown/MDX)
    concepts/         # .md and .mdx files for conceptual topics
    patterns/         # .md and .mdx files for design patterns
    practices/        # .md and .mdx files for practices
  pages/            # Astro pages
    concepts/         # [content collection route]
    patterns/         # [content collection route]
    practices/        # [content collection route]
    resources/      # Project resources and documentation pages. 
  styles/           # Global and component styles. 
public/             # Static assets (images, fonts, etc.)
  mermaid/          # Mermaid diagrams generated by `pnpm diagrams`

```

## 3. Operational Boundaries

### Tier 1: ALWAYS DO (Constitutive Rules)
- **ALWAYS** explicitly import every component used in `.astro` files.
- **ALWAYS** validate content against `src/content/config.ts`.
- **ALWAYS** run `pnpm check` before confirming a task is done.
- **ALWAYS** use `z.coerce.date()` for date fields in schemas.
- **ALWAYS** enforce One H1 Per Page: The h1 tag is reserved for the page title (handled by the layout). All .md/.mdx content in content collections MUST start with h2 (##) to maintain a correct document outline.

### Tier 2: ASK FIRST (Procedural Guardrails)
- **ASK** before adding new dependencies to `package.json`.
- **ASK** before modifying `src/styles/global.css` (This is the immutable design token source).
- **ASK** before deleting content files.
- **ASK** before using scoped CSS in .astro files (Prefer global CSS).

### Tier 3: NEVER DO (Hard Constraints)
- **NEVER** use `any`. "Vibe coding" is strictly prohibited.
- **NEVER** use legacy `type: 'content'` for collections (Use `loader: glob()`).
- **NEVER** output code with broken imports (Hallucination check required).
- **NEVER** link CSS via `<link href="/src/...">` (Must import in frontmatter).

## 4. Command Registry

Use these exact commands. Do not guess.

|Intent|Command|Context|
|---|---|---|
|**Dev Server**|`pnpm dev`|Starts local server on 4321|
|**Build**|`pnpm build`|Generates static output; fails on type errors|
|**Type Check**|`pnpm check`|Runs Astro/TS type validation (0 errors allowed)|
|**Lint/Format**|`pnpm lint`|Runs Biome checks|
|**Preview**|`pnpm preview`|Serves the production build locally|
|**Update**|`pnpm outdated`|Checks dependency currency|

## 5. Coding Standards & Patterns

The following rules use XML structure to optimize your attention mechanism. Adhere strictly.

```xml
<coding_standard name="Explicit Component Imports">
  <instruction> Astro does not auto-import components. You must explicitly import every component, layout, or utility used in the frontmatter. 
  </instruction> 
  <anti_pattern>
--- 
// Missing imports 
--- 
<Card title="Hello" />
  </anti_pattern> 
  <preferred_pattern> 
--- 
import Card from '../components/Card.astro'; 
import Layout from '../layouts/Layout.astro'; 
--- 
<Layout> 
  <Card title="Hello" />
</Layout>
  </preferred_pattern>
</coding_standard>


<coding_standard name="Modern Content Layer"> <instruction> Use the Astro 5+ `glob` loader for content collections. Do not use the legacy `content` folder pattern unless strictly necessary for migration. </instruction> <anti_pattern> const blog = defineCollection({ type: 'content', // Legacy schema: ... }); </anti_pattern> <preferred_pattern> import { glob } from 'astro/loaders'; const blog = defineCollection({ loader: glob({ pattern: '**/*.md', base: './src/content/blog' }), schema: ... }); </preferred_pattern> </coding_standard>

<coding_standard name="Design System Integrity"> <instruction> Do not introduce Tailwind classes or arbitrary hex codes. Use the CSS variables defined in `global.css` to maintain the "Industrial" aesthetic. </instruction> <anti_pattern> <div class="text-gray-500 font-bold">...</div> </anti_pattern> <preferred_pattern> <div class="spec-label">...</div> <style> .spec-label { color: var(--color-text-muted); font-family: var(--font-mono); } </style> </preferred_pattern> </coding_standard>
```

## 6. External Agent Submission Guidelines

(Preserved from original protocols for external contributors)

When an **external AI agent** submits work items, the following protocol MUST be followed:

### 6.1. Required Context Review

Before generating ANY recommendations, external agents MUST read:

1. `AGENTS.md` (This file)
    
2. `src/content/config.ts` (Data Schema)
    
3. `src/styles/global.css` (Design Tokens)
    

### 7.3. Success Criteria

- **Reflexion:** If a build fails, analyze the error, update your plan, and retry. Do not loop blindly.
    
- **Scope:** Do not "fix" unrelated files. Stick to the PBI.
